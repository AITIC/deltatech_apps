<?xml version="1.0" encoding="utf-8"?>
<!--Counters reports -->
<openerp>
    <data>
        <template id="equipment_counters_document">
                <style type="text/css">
                    tbody.default td {
                    border: 1px solid gray;
                    text-align: center;
                    font-size: 75%;
                    }
                    tbody.bold td {
                    border: 1px solid gray;
                    text-align: right;
                    font-size: 75%;
                    font-weight:bold;
                    background-color:#BBBBBB;
                    text-align: center;
                    }
                    thead.default th{
                    border: 1px solid gray;
                    background-color:#BBBBBB;
                    font-size: 75%;
                    }
                </style>
                <div class="page">
                    <span style="font-weight:bold;font-size:16px;">Echipament: <span t-field="o.name"/></span>
                    <span style="font-weight:bold;font-size:16px;">seria <span t-field="o.serial_id"/></span>
                    <br/>
                    <t t-if="o.address_id">
                        <span style="font-weight:bold;font-size:16px;">Instalat la: <span t-field="o.address_id"/></span>
                    </t>
                    <t t-if="not o.address_id">
                        <span style="font-weight:bold;font-size:16px;">Instalat la: (neinstalat)</span>
                    </t>
                    <br/>
                    <t t-set="readings" t-value="o.get_readings()"/>
                    <table>
                        <thead class="default">
                            <th>Data</th>
                            <th>Contor</th>
                            <th>Instalat la</th>
                            <th>Contract</th>
                            <th>Valoare precedenta</th>
                            <th>Valoare citire</th>
                            <th>Diferenta</th>
                        </thead>
                        <tbody class="default">
                            <tr t-foreach="readings.sorted(key=lambda r: r.date)" t-as="reading">
                                <td><span t-field="reading.date"/></td>
                                <td><span t-field="reading.meter_id"/></td>
                                <td><span t-field="reading.address_id"/></td>
                                <td><span t-field="reading.equipment_history_id.agreement_id"/></td>
                                <td><t t-esc="'{0:,.0f}'.format(reading.previous_counter_value)" /></td>
                                <td><t t-esc="'{0:,.0f}'.format(reading.counter_value)" /></td>
                                <td><t t-esc="'{0:,.0f}'.format(reading.difference)" /></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
        </template>


        <template id="report_equipment_counters">
            <t t-call="report.html_container">
                <t t-foreach="doc_ids" t-as="doc_id">
                    <t t-raw="translate_doc(doc_id, doc_model, 'env.user.partner_id.lang', 'deltatech_service_equipment.equipment_counters_document')"/>
                </t>
            </t>
        </template>


        <template id="equipment_agreement_counters_document">

                <div class="page">
                    <h3>Contract: <span t-field="o.name"/> / <span t-field="o.date_agreement"/> </h3>
                    <span t-field="o.partner_id"/>
                    <t t-set="rd" t-value="o.get_counters()"/>

                    <t t-set="equipments" t-value="[]"/>
                    <t t-foreach="rd" t-as="readings">
                        <t t-set="equipments" t-value="equipments+[readings.equipment_id]"/>
                    </t>
                    <t t-foreach="set(equipments)" t-as="equipment">
                        <h3><span t-field="equipment.name"/></h3>
                        <strong style="margin-top:0px;margin-bottom:2px;">Amplasament:<span t-field="equipment.emplacement"/></strong>
                        <strong style="margin-top:0px;margin-bottom:2px;">Serie:<span t-field="equipment.serial_id"/></strong>
                        <table>
                            <thead class="default">
                                <th>Data</th>
                                <th>Contor</th>
                                <th>Instalat la</th>
                                <th>Valoare precedenta</th>
                                <th>Valoare citire</th>
                                <th>Diferenta</th>
                            </thead>

                            <tbody class="default">
                                <t t-foreach="rd" t-as="reading">
                                    <t t-if="equipment.id==reading.equipment_id.id">
                                        <tr>
                                            <td><span t-field="reading.date"/></td>
                                            <td><span t-field="reading.meter_id"/></td>
                                            <td><span t-field="reading.address_id"/></td>
                                            <td><t t-esc="'{0:,.0f}'.format(reading.previous_counter_value)" /></td>
                                            <td><t t-esc="'{0:,.0f}'.format(reading.counter_value)" /></td>
                                            <td><t t-esc="'{0:,.0f}'.format(reading.difference)" /></td>
                                        </tr>
                                    </t>
                                </t>
                            </tbody>
                        </table>
                    </t>
                </div>
        </template>

        <template id="report_agreement_counters">
            <t t-call="report.html_container">
                <t t-foreach="doc_ids" t-as="doc_id">
                    <t t-raw="translate_doc(doc_id, doc_model, 'env.user.partner_id.lang', 'deltatech_service_equipment.equipment_agreement_counters_document')"/>
                </t>
            </t>
        </template>

        <template id="equipment_invoice_counters_document">
            <div class="page">
                <t t-set="meters" t-value="[]"/>
                <t t-set="readings" t-value="o.get_counters()"/>
                <t t-foreach="readings" t-as="reading">
                    <t t-set="meters" t-value="meters+[reading.meter_id.meter_categ_id]"/>
                </t>
                <strong>Factura: <span t-field="o.number"/> / <span t-field="o.date_invoice"/></strong><br/>
                Client: <span t-field="o.partner_id"/><br/>
                Contract: <span t-field="o.agreement_id"/>/<span t-field="o.agreement_id.date_agreement"/><br/>
                <t t-foreach="set(meters)" t-as="meter">
                    <t t-set="total_readings" t-value="0"/>
                    <table>
                        <thead class="default">
                            <th>Data</th>
                            <th>Echipament</th>
                            <th>Contor</th>
                            <th>Instalat la</th>
                            <th>Valoare precedenta</th>
                            <th>Valoare citire</th>
                            <th>Diferenta</th>
                        </thead>
                        <tbody class="default">
                            <t t-foreach="readings" t-as="reading">
                                <t t-if="reading.meter_id.meter_categ_id==meter">
                                    <tr>
                                        <td><span t-field="reading.date"/></td>
                                        <td><span t-field="reading.equipment_id"/></td>
                                        <td><span t-field="reading.meter_id"/></td>
                                        <td><span t-field="reading.address_id"/></td>
                                        <td><t t-esc="'{0:,.0f}'.format(reading.previous_counter_value)" /></td>
                                        <td><t t-esc="'{0:,.0f}'.format(reading.counter_value)" /></td>
                                        <td><t t-esc="'{0:,.0f}'.format(reading.difference)" /></td>
                                        <t t-set="total_readings" t-value="total_readings+reading.difference"/>
                                    </tr>
                                </t>
                            </t>
                            <tr>
                                <td colspan="6" style="text-align:right;font-weight:bold;">Total: </td>
                                <td style="font-weight:bold;"><t t-esc="'{0:,.0f}'.format(total_readings)" /></td>
                            </tr>
                        </tbody>
                    </table>
                </t>
            </div>
        </template>

        <template id="report_invoice_counters">
            <t t-call="report.html_container">
                <t t-foreach="doc_ids" t-as="doc_id">
                    <t t-raw="translate_doc(doc_id, doc_model, 'env.user.partner_id.lang', 'deltatech_service_equipment.equipment_invoice_counters_document')"/>
                </t>
            </t>
        </template>



    </data>
</openerp>